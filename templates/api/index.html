<html>
<head>
    <title>Add Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script>
        let map;

        function initMap() {
            const geocoder = new google.maps.Geocoder();

            myOptions = {
                zoom: 4,
                center: {lat: -34.397, lng: 150.644},
            };

            map = new google.maps.Map(document.getElementById('map'), myOptions);

            Marker = new google.maps.Marker({
                position: {lat: -34.397, lng: 150.644},
                map: map,
                draggable: true,
            });
            Marker.setMap(map);


            findLocation()

            const locationButton = document.createElement("button");

            locationButton.textContent = "Определить местоположение";
            locationButton.classList.add("custom-map-control-button");
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
            locationButton.addEventListener("click", () => {
                findLocation()
            });


            function findLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const pos = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                            };
                            getAddress(pos)
                            map.setCenter(pos);
                        },
                        () => {
                            // Ошибка о том что не удалось определить местоположение
                        }
                    );
                } else {
                    // Ошибка о том что не удалось определить местоположение
                }
            }


            function getAddress(latlng) {
                geocoder
                    .geocode({location: latlng},)
                    .then((response) => {
                        if (response.results[0]) {
                            map.setZoom(11);

                            const marker = new google.maps.Marker({
                                position: latlng,
                                map: map,
                            })
                            //Здесь тебе нужно вместо вывода отправить данные об адресе в форму местоположения
                            console.log(response.results[0].formatted_address)
                        } else {
                            window.alert("No results found");
                        }
                    })
            }
        }

        window.initMap = initMap;

    </script>
    <style>
        #map {
            height: 500px;
            width: 650px;
        }

    </style>
</head>
<body>

<h3>Map</h3>

<div id="map"></div>
<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXgV7Xnqc6mVvOVbz8ljhMF1_BEjopOEA&language=ru
&callback=initMap&v=weekly"
        defer
        async
></script>
</body>
</html>